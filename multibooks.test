<?php

class MultibooksFunctionalTest extends DrupalWebTestCase {

  public static function getInfo() {
    return array(
      'name' => 'Multibooks functional tests',
      'description' => "Test the addition, deletion and rearrangement of nodes' secondary books.",  
      'group' => 'Multibooks',
    );
  }

  private $multibook_editor;
  private $blue_cover;
  private $blue_page1;
  private $blue_page2;
  private $green_cover;

  public function setUp() {
    // Enable modules
    parent::setUp('node', 'book', 'multibooks');

    // Create and login with user
    $this->multibook_editor = $this->drupalCreateUser(array(
      'access content',
      'create page content',
      'edit secondary books',
    ));
    $this->drupalLogin($this->multibook_editor);

    // Set up two normal books
    $this->blue_cover = $this->drupalCreateNode(array(
      'type'  => "page",
      'title' => "Blue book cover",
      'book'  => array('bid' => 'new'),
    ));
    $this->blue_page1 = $this->drupalCreateNode(array(
      'type'  => "page",
      'title' => "Blue page1",
      'book'  => array('bid' => $this->blue_cover->nid),
    ));
    $this->blue_page2 = $this->drupalCreateNode(array(
      'type'  => "page",
      'title' => "Blue page2",
      'book'  => array('bid' => $this->blue_cover->nid),
    ));
    $this->green_cover = $this->drupalCreateNode(array(
      'type'  => "page",
      'title' => "Green book cover",
      'book'  => array('bid' => 'new'),
    ));
  }

  public function testAddSinglePage() {
    $this->drupalGet("node/{$this->blue_cover->nid}");
    $this->assertLink($this->blue_page1->title);
    $this->assertLink($this->blue_page2->title);
  }
}
